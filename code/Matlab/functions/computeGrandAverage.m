function computeGrandAverage(DIR)

% load EEGlab (
DIR.EEGLAB_PATH = '/data/p_02453/packages/eeglab2021.0';
rmpath(genpath(DIR.EEGLAB_PATH)); 
cd(DIR.EEGLAB_PATH);
eeglab; close;

DIR.processed = convertStringsToChars(DIR.processed);
DIR.grandaverage = convertStringsToChars(DIR.grandaverage);

% 101_102: Deviant Training speaker
EEG = pop_grandaverage({'01_processed_101.set', '02_processed_101.set', ...
    '04_processed_102.set', '05_processed_101.set', '06_processed_101.set', ...
    '07_processed_102.set', '08_processed_102.set', '09_processed_101.set', ...
    '10_processed_101.set', '11_processed_102.set', '12_processed_102.set', ...
    '13_processed_101.set', '15_processed_102.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 101-102');
EEG = pop_saveset(EEG, 'filename', 'ga_101-102.set','filepath', DIR.grandaverage);

% 103: Deviant speaker 3
EEG = pop_grandaverage( {'01_processed_103.set', '02_processed_103.set', ...
    '04_processed_103.set', '05_processed_103.set', '06_processed_103.set', ...
    '07_processed_103.set', '08_processed_103.set', '09_processed_103.set', ...
    '10_processed_103.set', '11_processed_103.set', '12_processed_103.set', ...
    '13_processed_103.set', '15_processed_103.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 103');
EEG = pop_saveset( EEG, 'filename', 'ga_103.set','filepath', DIR.grandaverage);

% 104: Deviant speaker 4
% NB i took out 12_104, becasue it does not have a lot of good trials, and
% in some of the preproc pipelines, it thus gives an error 
EEG = pop_grandaverage( {'01_processed_104.set', '02_processed_104.set', ...
    '04_processed_104.set', '05_processed_104.set', '06_processed_104.set', ...
    '07_processed_104.set', '08_processed_104.set', '09_processed_104.set', ...
    '10_processed_104.set', '11_processed_104.set', ...
    '13_processed_104.set', '15_processed_104.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 104');
EEG = pop_saveset( EEG, 'filename', 'ga_104.set','filepath', DIR.grandaverage);

% 231-232: one standard training speaker
EEG = pop_grandaverage( {'01_processed_231.set', ...
    '02_processed_231.set', ...
    '04_processed_232.set', ...
    '05_processed_231.set', ...
    '06_processed_231.set', ...
    '07_processed_232.set', ...
    '08_processed_232.set', ...
    '09_processed_231.set', ...
    '10_processed_231.set', ...
    '11_processed_232.set', ...
    '12_processed_232.set', ...
    '13_processed_231.set', ...
    '15_processed_232.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 231-232');
EEG = pop_saveset( EEG, 'filename', 'ga_231-232.set','filepath', DIR.grandaverage);

% 233: one standard speaker 3
EEG = pop_grandaverage( {'01_processed_233.set', ...
    '02_processed_233.set', ...
    '04_processed_233.set', ...
    '05_processed_233.set', ...
    '06_processed_233.set', ...
    '07_processed_233.set', ...
    '08_processed_233.set', ...
    '09_processed_233.set', ...
    '10_processed_233.set', ...
    '11_processed_233.set', ...
    '12_processed_233.set', ...
    '13_processed_233.set', ...
    '15_processed_233.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 233');
EEG = pop_saveset( EEG, 'filename', 'ga_233.set','filepath', DIR.grandaverage);

% 234: one standard speaker 4
EEG = pop_grandaverage( {'01_processed_234.set', ...
    '02_processed_234.set', ...
    '04_processed_234.set', ...
    '05_processed_234.set', ...
    '06_processed_234.set', ...
    '07_processed_234.set', ...
    '08_processed_234.set', ...
    '09_processed_234.set', ...
    '10_processed_234.set', ...
    '11_processed_234.set', ...
    '13_processed_234.set', ...
    '15_processed_234.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 234');
EEG = pop_saveset( EEG, 'filename', 'ga_234.set','filepath', DIR.grandaverage);


% 221-231-222-232: two standards training speaker
EEG = pop_grandaverage( {'01_processed_221.set', '01_processed_231.set', ...
    '02_processed_221.set', '02_processed_231.set', ...
    '04_processed_222.set', '04_processed_232.set', ...
    '05_processed_221.set', '05_processed_231.set', ...
    '06_processed_221.set', '06_processed_231.set', ...
    '07_processed_222.set', '07_processed_232.set', ...
    '08_processed_222.set', '08_processed_232.set', ...
    '09_processed_221.set', '09_processed_231.set', ...
    '10_processed_221.set', '10_processed_231.set', ...
    '11_processed_222.set', '11_processed_232.set', ...
    '12_processed_222.set', '12_processed_232.set', ...
    '13_processed_221.set', '13_processed_231.set', ...
    '15_processed_222.set', '15_processed_232.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 221-231-222-232');
EEG = pop_saveset( EEG, 'filename', 'ga_221-231-222-232.set','filepath', DIR.grandaverage);

% 223-233: two standards speaker 3
EEG = pop_grandaverage( {'01_processed_223.set', '01_processed_233.set', ...
    '02_processed_223.set', '02_processed_233.set', ...
    '04_processed_223.set', '04_processed_233.set', ...
    '05_processed_223.set', '05_processed_233.set', ...
    '06_processed_223.set', '06_processed_233.set', ...
    '07_processed_223.set', '07_processed_233.set', ...
    '08_processed_223.set', '08_processed_233.set', ...
    '09_processed_223.set', '09_processed_233.set', ...
    '10_processed_223.set', '10_processed_233.set', ...
    '11_processed_223.set', '11_processed_233.set', ...
    '12_processed_223.set', '12_processed_233.set', ...
    '13_processed_223.set', '13_processed_233.set', ...
    '15_processed_223.set', '15_processed_233.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 223-233');
EEG = pop_saveset( EEG, 'filename', 'ga_223-233.set','filepath', DIR.grandaverage);

% 224-234: two standards speaker 4
EEG = pop_grandaverage( {'01_processed_224.set', '01_processed_234.set', ...
    '02_processed_224.set', '02_processed_234.set', ...
    '04_processed_224.set', '04_processed_234.set', ...
    '05_processed_224.set', '05_processed_234.set', ...
    '06_processed_224.set', '06_processed_234.set', ...
    '07_processed_224.set', '07_processed_234.set', ...
    '08_processed_224.set', '08_processed_234.set', ...
    '09_processed_224.set', '09_processed_234.set', ...
    '10_processed_224.set', '10_processed_234.set', ...
    '11_processed_224.set', '11_processed_234.set', ...
    '13_processed_224.set', '13_processed_234.set', ...
    '15_processed_224.set', '15_processed_234.set'}, ...
    'pathname', DIR.processed);
EEG = pop_editset(EEG,'setname', 'GA 224-234');
EEG = pop_saveset( EEG, 'filename', 'ga_224-234.set','filepath', DIR.grandaverage);




% a different way to get the grand avs

% Subj = ["01" "02" "04" "05" "06" "07" "08" "09" "10" "11" "12" "13" "15"];
% 
% j = 1; % counting variable
% for s = 1:13
%     % Load epoched EEG data
%     load_103 = convertStringsToChars(strcat(Subj(s), '_processed_103.set'));
%     EEG = pop_loadset('filename',load_103,'filepath',DIR.processed);
%     %
%     epo_103 = EEG.data(:,:,:);
%     erp_103(:,:,j) = mean(epo_103, 3);
%     j= j +1;
% end




end